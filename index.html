<!DOCTYPE html>
<html>
<head>
	<title>Cloudiopsy </title>
	<link href="https://fonts.googleapis.com/css?family=Lato:300,700" rel="stylesheet">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link href="style.css" type="text/css" rel="stylesheet"/>

	<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.14.1/dist/tf.min.js"></script>

	<script>

		
	   function previewFile(){
	       var preview = document.querySelector('img[class=preview]'); 
	       var file    = document.querySelector('input[type=file]').files[0];
	       var reader  = new FileReader();

	       reader.onloadend = function () {
	           preview.src = reader.result;
	       }

	       if (file) {
	           reader.readAsDataURL(file); 
	       } else {
	           preview.src = "";
	       }
   	   }

   	   function analyze() {
   	   		var file    = document.querySelector('input[type=file]').files[0]; 
   	   		if (file) {
   	   			runModel(file)
   	   		} else {
   	   			alert("Please input a file.")
   	   		}
   	   }


   	   let model;

		async function loadModel() {

		  // clear the model variable
		  model = undefined;
		  
		  // load the model using a HTTPS request (where you have stored your model files)
		  model = await tf.loadModel('https://cloudiopsy.github.io/model.json');
		
		}

   	   async function runModel(file) {
   	   		loadModel();
   	   		const model = await tf.loadModel('https://cloudiopsy.github.io/model.json');

   	   		// Convert image to tensor
   	   		let img_tensor = tf.fromPixels(document.getElementById("preview")).resizeNearestNeighbor([150, 150]);
   	   		img_tensor = tf.expandDims(img_tensor, axis=0);

   	   		img_tensor = tf.div(img_tensor, 255);
   	   		let predictions = await model.predict(img_tensor).data();

   	   		if(predictions[0] < 0.25) {
   	   			document.getElementById("prediction-text").innerHTML = predictions[0] + ": This tissue is deemed as normal!";
   	   		} else {
   	   			document.getElementById("prediction-text").innerHTML = predictions[0] + ": This tissue is deemed as tumour!";
   	   		}


   	   		// alert(prediction);


   	   }




</script>

</head>
<body>

<div class="header info">
<div class="header-text">
 CLOUDIOPSY <img src="logo.png"/>
</div>
<div class="subheader">
A Colorectal Cancer Prediction Platform created through
<br/> Tensorflow
</div>

<div class="side-image">
<img src="cancer.png"/>
</div>
</div>


<label class="custom-file-upload">
   <div class="submission upload">
    <span class="glyphicon glyphicon-open"> 
	</span> UPLOAD </label>
	</div>
	<input name="img" type="file" accept="image/*" onclick="window.location.hash = '';window.location.hash = 'analysis-section'" onchange="previewFile()"/>
</label>


<div id="analysis-section">
<h1>Click Analyze to Run the Neural Network!</h1> 
<img src="" class="preview" id="preview" alt="Image preview"/>

<p id="prediction-text"></p>

<button class="submission analyze" onclick=
"analyze()"> <span class="glyphicon glyphicon glyphicon-stats"> 
	</span> ANALYZE </label>
</button>
</div>





</body>
</html>